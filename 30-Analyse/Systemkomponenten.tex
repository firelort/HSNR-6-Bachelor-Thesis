\section{Systemkomponenten}\label{sec:Systemkomponenten}

\subsection{Komponenten des Servers}\label{subsec:Komponente_des_Servers}
Im folgenden werden die verschiedenen Komponenten des Auswertungs- und Überwachungssystems in der derzeitigen Implementierung untersucht. Dabei werden Rückschlüsse auf Anforderungen gezogen sowie Schwachstellen und Verbesserungsmöglichkeiten herausgearbeitet.

\subsubsection{Scanner}\label{subsubsec:Scanner}
Der Scanner prüft in regelmäßigen Abständen die auf den Gastsystemen der Studierenden installierten Dienste und speichert das Ergebnis ab. Die Abstände können beim Starten des Spieles eingestellt werden. Die folgenden Dienste werden pro Team geprüft.

\paragraph{ScanUp}\label{para:ScanUp}
Die Aufgabe dieses Scans besteht darin zu prüfen, ob das Gastsystem noch für den Server erreichbar ist. Sollte das Gastsystem nicht erreichbar sein wird hierfür ein Strafpunkt vergeben. Aus technischer Sicht wird das Linux Kommando \textit{ping} verwendet. An Hand des Rückgabewertes kann nachvollzogen werden, ob der Server das Gastsystem erreichen konnte.

\paragraph{ScanBubble}\label{para:ScanBubble}
Auf dem Gastsystem läuft ein selbst programmierter Bubble Server, welcher Flags via Telnet bereitstellt. Nachdem eine Flag abgeholt worden ist, erfolgt ein Timeout, sodass für eine bestimmte Zeit keine weitere Flag abgeholt werden kann. Der Bubble Server nimmt Anfragen auf dem Port \textit{12321} für unverschlüsselte Flags und Port \textit{12322} für verschlüsselte Flags entgegen.
Die Scan-Operation überprüft, ob eine Telnet Verbindung zu dem Port \textit{12321} möglich ist, in dem die Operation eine Telnet Verbindung öffnet und prüft, ob die Verbindung erfolgreich war.

\paragraph{ScanWebUp}\label{para:ScanWebUp}
Jedes Gastsystem stellt mit Hilfe eines Apache Web Servers und php-Dateien Webseiten und Daten bereit, welche mit Hilfe von Web Clients abgerufen werden können. Dazu muss auf Port \textit{80} der HTTP- und auf Port \textit{443} der HTTPS Dienst laufen. Dieses verifiziert die Scan-Operation in dem eine Socket Verbindung zu den Ports \textit{80} und \textit{443} geöffnet und das Ergebnis prüft wird.

\paragraph{ScanSQLInjectUp}\label{para:ScanSQLInjectUp}
Dieser Scan prüft, ob die SQL Injection des Teams erreichbar und benutzbar ist. Die Operation sendet hierzu einen valide Kombination aus Nutzername und Passwort an den Webserver. Das Ergebnis wird dann mit dem erwarteten Ergebnis verglichen.

\paragraph{ScanSQLInjectSave}\label{para:ScanSQLInjectSave}
Wie bei ScanSQLInjectUp (\ref{para:ScanSQLInjectUp}) wird geprüft ob das erwartet Ergebnis zurückgeliefert wird. Besonderheit hierbei ist, dass statt einer validen Kombination aus Nutzernamen und Passwort eine SQL Injection im Nuterznamen übergeben wird. So kann geprüft werden, ob das Team die SQL Injection abgesichert hat.

\paragraph{ScanXSSSave}\label{para:ScanXSSSave}
Diese Scan-Operation prüft, ob die auf dem Gastsystem implementierte XSS Schwachstelle behoben worden. Dazu wird die Webseite mit präparieren Inhalt aufgerufen. In der Rückgabe wird geprüft, ob der Inhalt ungefiltert auf der Webseite zu finden ist. Sollte diese der Fall sein, ist die XSS Schwachstelle nicht oder unzureichend von den Studierenden abgesichert worden.

\paragraph{ScanSQLSave}\label{para:ScanSQLSave}
Bei diesem Scan wird kontrolliert, ob die Verbindung mit dem auf allen System voreingestellten Passwort \textit{toor} auf dem Root Account \textit{root} der SQL Datenbank möglich ist. Oder ob die Studierenden dieses unsichere Passwort geändert haben. Auch wird geprüft, ob das htaccess Passwort von phpMyAdmin Pafd geändert worden ist.

\paragraph{ScanFTPSave}\label{para:ScanFTPSave}
Auf dem Client System läuft ein FTP Server, welcher ohne Login (Nutzername \& Passwort) Daten bereitstellt. Der Scan prüft, ob ein sogenannter Anonymous Login möglich ist, in dem eine FTP Verbindung ohne Login aufgebaut wird. Sollte die Verbindung erfolgreich sein, ist der Anonymous Login immer noch möglich.

\paragraph{ScanTelnetSave}\label{para:ScanTelnetSave}
Ein Telnet Server wartet auf Verbindungen auf Port \textit{23}. Da dieser Dienst nicht benötigt wird, sollen die Studierende diesen abschalten oder deinstallieren. Die Scan-Operation prüft, ob eine Verbindung via Telnet auf Port \textit{23} möglich ist, in dem dieser eine Verbindung via Telnet zu Port \textit{23} aufbaut und prüft ob dieses erfolgreich war.

\subsubsection{Generierung von Flags}\label{subsubsec:Generierung_von_Flags}

Derzeitig erfolgt die Generierung der Flags sowohl auf den Gastsystemen als auch auf dem Auswertungs- und Überwachungssystem. Dies ist notwendig, da ansonsten eine Überprüfung der Gültigkeit der Flags und Verrechnung der Punkte nicht durchgeführt werden kann. Die Flags werden durch einen Algorithmus generiert. Dieser erzeugt pro Team eine bestimmte Anzahl an Flags. 

Dazu wird die Flag mithilfe der Streuwertfunktion (Hashfunktion) MD5 und der Eingabe, einem sogenanntem seed, berechnet. Eine Hashfunktion bildet aus einer Eingabe variabler Länge eine Ausgabe mit einer festen Länge. Bei selber Eingabe wird immer der gleiche Ausgabewert berechnet. Des Weiteren ist es bei einer guten Hashfunktion nicht möglich von der Ausgabe auf den Eingabewert zuschließen.
(todo: Quelle Ueberholz)
(todo: was ist MD5, ist das wirklich wichtig?)

Der in der Anwendung genutzte seed setzt sich aus der Verkettung von \textit{Salt}, \textit{IP-Adresse}, dem Wort \textquote{\textit{Aufgabe}} und einem \textit{Zähler} zusammen.

Ein Salt wird benötigt, um den Flags eine Lebenszeit zu geben. In der derzeitigen Implementierung enthält der Salt das aktuelle Jahr sowie das jeweilige Semester. So sind nur Flags des aktuellen Semesters gültig und werden vom Auswertungs- und Überwachungssystems akzeptiert. Eine Verwendung von Flags aus vorherigen Semestern wird somit effektiv vorgebeugt.

Die IP-Adresse stellt hierbei den Bezug zum jeweiligen Team dar.

Die Zeichenfolge \textquote{Aufgabe} wird als Geheimnis verwendet, um das Fälschen von Flags zu erschweren und im bestenfall zu verhindern.

Damit pro Team mehrere eindeutige Flags geniert werden können, wird ein sogenannter Zähler genutzt. Dieser Zähler ist auf 0 initialisiert und wird pro generierter Flag um eins erhöht, bis die benötigte Anzahl an Flags generiert ist.\cite[S.48]{sosnaKonzeptionUndRealisierung2010}

\subsubsection{Webserver}\label{subsubsec:Webserver}

Der Webserver stellt die GUI (Graphical User Interface) für die Studierenden und Betreuer dar. Hier kann der aktuelle Punktestand angesehen werden. Auch wird in der GUI dargestellt, welches Team welchen Service abgesichert hat, inklusive der negative Punkte für nicht abgesicherte Dienste, und wie viele Strafpunkte das jeweilige Team erhalten hat.

Neben diesen Darstellungen befindet sich auf dem Server ein sogenannter Flagshop und diverse Challenges mit denen Studierende weiter Flags erhalten können.

Die Betreuer haben die Möglichkeit über die Web-GUI ein neues Spiel anzulegen, das Spiel zu starten oder zu stoppen. Auch kann von dem Spiel ein Backup erstellt werden. Neben diesen Funktionen zur Spielsteuerung können an die Teams Strafen für unfaires oder regelverletzendes Verhalte verteilt werden. Diese nehmen direkten Einfluss auf die Punkte des jeweiligen Teams. Auch besteht die Möglichkeit weiter Benutzer für das Administrationsinterface zu registrieren.

\paragraph{Flagshop} \label{para:Flagshop}
Der Flagshop ermöglicht den den Studierenden weiter Flags mit ihren Punkten zu kaufen. Der Kauf von Flags lohnt sich schon, da die verkauften Flags mehr Punkte bringen als das sie kosten. Um einen Einkauf im Flagshop durchzuführen, müssen die Teams sich vorher einen Account erstellen. Die Registrierung erfragt neben dem benötigten Benutzernamen und Passwort auch für den Flagshop irrelevante Daten ab. Diese ähneln persönlichen Informationen, welche bei den meisten Onlineshop angegeben werden müssen. Das Format, hier die Repräsentation als Zahl oder Zeichenfolge sowie die Länge, und die Erforderlichkeit der Daten wird nur im HTML-Formular festgelegt. Durch eine Manipulierung des Formulars kann dieses mit nicht konformen oder nicht vorhanden Daten abgesendet werden. Für jeder der nicht vorhanden oder nicht konformen Informationen erhält der Studierende eine Flag. Daneben wird die Güte des angegebenen Passwortes anhand von Länge und Anzahl an Sonderzeichen, Groß- und Kleinbuchstaben sowie Ziffern bewertet und mit Flags belohnt.

Nach der Registrierung können die Studierende sich für ihre Punkte Flags kaufen. Dazu stehen zwei Pakete mit 8 bzw. 6 Flags für den Preis von jeweils 4 Punkten pro Paket zur Verfügung. Dieser Preis kann auf zwei Arten reduziert werden. 
Bei der ersten Art müssen die beiden Pakete gleichzeitig im Warenkorb sein und die Identifikationsnummern (ID) dieser auf nicht vorhanden Nummern gesetzt werden. Die Manipulation resultiert in einem reduzierten Preis von 4 Punkten für beide Pakete. Dies ist extra im Flagshop einprogrammiert und soll die Studierenden auf Manipulation von IDs aufmerksam machen.
Durch die zweite Art ist es möglich die Paket umsont zu erhalten. Dazu muss im Warenkorb, dass sogenannte \textit{hidden input} Feld in dem der aktuelle Preis des Warenkorbs gespeichert wird auf 0 gesetzt werden. So berechnet der Flagshop für den Kauf keine Kosten und die Flags können kostenlos erhalten werden.\cite[S. 63]{abtsUeberarbeitungUndErweiterung2016}

Ein \textit{hidden input} Feld wird in der Repräsentation eines HTML-Dokumentes nicht angezeigt, kann jedoch durch die Entwicklertools der Browser betrachtet und verändert werden. \cite{w3schoolsHTMLHiddenInput}

Auf diese Weise ist es auch möglich einen negativen Preis festzulegen und so dem eigenen Team Punkte zuzuschreiben, da eine Überprüfung in \textit{/flagshop/shop.php} nicht richtig implementiert ist. So wird nicht geprüft, ob der von dem Nutzer eingegeben Preis kleiner als 0 ist, sondern ob der Preis gleich 0 ist. Sollte diese der Fall sein, wird der Preis auf 0 gesetzt. Bei richtiger Implementierung würde ein negativer Preis auf 0 korrigiert.

\paragraph{Challenges} \label{para:Challenges}
Derzeitig sind fünf Challenges implementiert, welche vom System in zufälliger Reihenfolge an interessierte Teams verteilt werden. Eine abgeschlossene oder abgebrochene Challenge, durch das Neuladen der Webseite oder der Betätigen der Zurück-Taste, kann nicht wiederholt werden. Eine Challenge kostet 10 Punkte. Nach erfolgreichem Abschließen einer Challenge gibt es 10 Punkte plus eine gewisse Anzahl an Punkten für das Absolvieren der Aufgabe. Die folgenden Challenges sind implementiert\cite[S.19-20]{abtsUeberarbeitungUndErweiterung2016}.

\subparagraph{Aufgabe 1: robots.txt}\label{subpara:Aufgabe_1_robots.txt}
Hier sollen die Studierenden anhand der robots.txt den unbekannten Ordner, welcher von Suchmaschinen nicht indexiert wird, finden und dort die geheimen Informationen auslesen.

\subparagraph{Aufgabe 2: JavaScript-Login-Bypass}\label{subpara:Aufgabe_2_JavaScript-Login-Bypass}
Bei dieser Challenge ist die JavaScript Funktion im Quelltext versteckt. Das Verstecken ist mit einer Meldung, wie \textquote[\cite{abtsUeberarbeitungUndErweiterung2016}]{Seitenquelltext deaktiviert} und vielen Leerzeilen realisiert. In der Firefox Version 78.0.1 ist dieses nicht mehr möglich, da die Leerzeilen entfernt werden und die JavaScript Funktion daher oben im Quelltext zu sehen ist.

\subparagraph{Aufgabe 3: Form-Modification}\label{subpara:Aufgabe_3_Form-Modification}
In dieser Challenge sollen die Studierende verstehen, dass auch die Werte von Drop-Down-Menüs, Checkboxen und Radio-Buttons durch Manipulation auf nicht vorgegebene Werte geändert werden können. Deshalb ist bei diesen auch eine Serverseitige Überprüfung notwendig.

Die Aufgabe besteht darin einen bestimmten Login Namen aus einem Drop-Down-Menü auszuwählen. Da der Name nicht in dieser Liste ist, müssen die Studierenden das HTML Formular so manipulieren, dass diese den geforderten Namen auswählen können.

\subparagraph{Aufgabe 4: JavaScript-Substrings}\label{subpara:Aufgabe_4_JavaScript-Substrings}
Das Passwort, welches die Studierenden eingeben müssen, wird clientseitig mithilfe einer JavaScript Funktion geprüft. Damit das Passwort nicht im Klartext im Quelltext steht, wird dieses verschleiert. So werden drei Strings Zeichen für Zeichen verglichen. Sollten die Zeichen in mindestens zwei der drei Strings gleich sein, dann gehört das Zeichen zum Passwort. Im Anschluss wird das generierte Passwort mit dem durch die Studierenden gegebenen Passwort verglichen. Sollten die Passwörter gleich sein, ist die Challenge erfolgreich abgeschlossen.

\subparagraph{Aufgabe 5: URL-Hex-Injection}\label{subpara:Aufgabe_5_URL-Hex-Injection}
Die Studierenden sollen an geheime Informationen in HEX-Wert benannten Ordner gelangen. Diese Aufgabe soll zeigen, dass Ordner die nach einen HEX-Wert benannten sind, so nicht vor Zugriffen geschützt werden können, da das HEX-Zeichen \textit{\%} selber durch einen HEX-Wert dargestellt werden kann.

\subsubsection{Abgabe von Flags}\label{subsubsec:Abgabe_von_Flags}
Um Flags abgeben zu können, müssen die Studierenden sich mit ihren Hackits in der Web-GUI anmelden. Dort ist es möglich in einem Input Feld eine Flag synchron abzugeben. Das bedeutet, dass nach jeder Abgabe die Webseite neu geladen wird. Des Weiteren ist es nicht möglich mehrere Flags gleichzeitig abzugeben.

\subsection{Komponenten des Clients}\label{subsec:Komponente_des_Clients}
Da sich die Bachelorarbeit mit der Modernisierung des Auswertungs- und Überwachungssystem beschäftigt, sind nur die wichtigen Komponenten des Clients beschrieben.

\subsubsection{Webserver des Clients}\label{subsubsec:Webserver_des_Clients}
Auf den Clients läuft ein Webserver mit einigen Schwachstellen. 

So ist in das Kundenbewertungsformular eine XSS Schwachstelle implementiert. Durch die Schwachstelle wird die Nutzereingabe ungefiltert in das HTML Formular übernommen. Durch diese Schwachstelle kann bösartiger Code geladen werden. Dieser Code kann dann beispielsweise Cookies, Session Tokens oder andere vertrauliche Informationen auslesen und den Angreifern übermitteln. 

Eine weitere Schwachstelle stellt der sogenannte \textquote{Login zum Membersbereich} dar. Bei einem Login Versuch wird der Benutzername und das Passwort ungefiltert in eine SQL Statement eingefügt. So ist ein SQL Angriff auf die dahinter liegende Datenbank möglich. Durch solch einen Angriff können Daten ausgelesen werden. Diese Schwachstelle lässt sich erst beheben, wenn die Gruppe die SQL-Injection bei sich selber durchgeführt hat.

Neben diesen Schwachstellen gibt es eine Registrierung für den Flagshop. Dieses erfordert einige Eingaben, wie Name, Alter, Postleitzahl und vieles mehr. Die Eingaben sind im HTML-Formular als Pflicht markiert und haben eine Vorgabe der Form. Ein Absenden ist ohne Angabe dieser Daten nicht möglich. Die Studierenden erhalten jedoch für jede nicht getätigte und für jede nicht der Form entsprechenden Angabe Flags nach der Registrierung. Dies ist möglich, da das HTML-Formular durch die Studierenden geändert werden kann und der Server nur die Angaben bezüglich Passwort und Nutzername prüft. Diese beiden Angaben werden genutzt, um sich am Flagshop des Servers anzumelden und Flags zu erwerben. \textit{(Siehe: \ref{para:Flagshop} Flagshop)}

Außerdem stellt der Webserver eine Bildgalerie zur Verfügung in dieser befinden sich zwei Bilder, welche ebenfalls Flags enthalten.